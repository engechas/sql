SELECT accountid AS account_id, region, count(*) AS total_access_denied FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_cloud_trail_mgmt_2_0 WHERE api.response.error = 'AccessDenied' AND time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP GROUP BY accountid, region ORDER BY total_access_denied DESC LIMIT 10
SELECT accountid AS account_id, region, api.service.name AS aws_service, count(*) AS total_access_denied FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_cloud_trail_mgmt_2_0 WHERE api.response.error = 'AccessDenied' AND time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP AND accountid in ('123456789012') AND region = 'us-east-1' GROUP BY accountid, region, api.service.name ORDER BY total_access_denied DESC LIMIT 10
SELECT accountid AS account_id, region, actor.user.uid AS requestor_arn, src_endpoint.ip AS source_ip, api.service.name AS aws_service, api.operation AS api_operation, count(*) AS total_access_denied FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_cloud_trail_mgmt_2_0 WHERE api.response.error = 'AccessDenied' AND time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP AND accountid in ('123456789012') AND region = 'us-east-1' GROUP BY accountid, region, actor.user.uid, src_endpoint.ip, api.service.name, api.operation ORDER BY total_access_denied DESC LIMIT 10
SELECT time_dt, accountid AS account_id, region AS region, actor.user.uid AS requestor_arn, src_endpoint.ip AS source_ip, api.service.name AS aws_service, api.operation AS api_operation, api.request.data AS request_parameters, api.response.data AS response_elements, api.response.message AS response_message, api.response.error AS error FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_cloud_trail_mgmt_2_0 WHERE api.response.error = 'AccessDenied' AND time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP AND ( actor.user.uid = 'arn:aws:sts::123456789012:assumed-role/role/session' OR actor.session.issuer = 'arn:aws:sts::123456789012:role/myrole' ) AND accountid in ('123456789012') AND region = 'us-east-1' ORDER BY time_dt DESC
SELECT accountid AS account_id, region, http_request.user_agent AS user_agent, count(*) AS total_events FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_cloud_trail_mgmt_2_0 WHERE time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP AND accountid in ('123456789012') AND region = 'us-east-1' GROUP BY accountid, region, http_request.user_agent ORDER BY total_events LIMIT 10
SELECT time_dt, accountid AS account_id, region AS region, actor.user.uid AS requestor_arn, src_endpoint.ip AS source_ip, api.service.name AS aws_service, api.operation AS api_operation, api.request.data AS request_parameters, api.response.data AS response_elements, api.response.message AS response_message, api.response.error AS error FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_cloud_trail_mgmt_2_0 WHERE time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP AND http_request.user_agent = 'Mozilla 1.1' AND accountid in ('123456789012') AND region = 'us-east-1' ORDER BY time_dt DESC
SELECT src_endpoint.ip AS source_ip, accountid, actor.user.type AS user_type, CASE WHEN actor.user.type = 'IAMUser' THEN actor.user.name ELSE actor.user.uid END AS user_id, count(*) AS total_failed_login FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_cloud_trail_mgmt_2_0 WHERE api.operation = 'ConsoleLogin' AND time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP AND accountid in ('123456789012') AND region = 'us-east-1' AND GET_JSON_OBJECT(api.response.data, '$.ConsoleLogin') = 'Failure' GROUP BY src_endpoint.ip, accountid, actor.user.type, (CASE WHEN (actor.user.type = 'IAMUser') THEN actor.user.name ELSE actor.user.uid END) ORDER BY total_failed_login DESC
SELECT time_dt, accountid AS account_id, region AS region, actor.user.uid AS requestor_arn, actor.user.name AS user_name, src_endpoint.ip AS source_ip, api.operation AS api_operation, GET_JSON_OBJECT(api.response.data, '$.ConsoleLogin') AS auth_status, http_request.user_agent AS user_agent FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_cloud_trail_mgmt_2_0 WHERE api.operation = 'ConsoleLogin' AND time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP AND src_endpoint.ip = '192.168.1.0' AND accountid in ('123456789012') AND region = 'us-east-1' ORDER BY time_dt DESC
SELECT time_dt, accountid AS account_id, region AS region, actor.user.name AS user_name, src_endpoint.ip AS source_ip, api.operation AS api_operation, GET_JSON_OBJECT(api.response.data, '$.ConsoleLogin') AS auth_status, http_request.user_agent AS user_agent FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_cloud_trail_mgmt_2_0 WHERE api.operation = 'ConsoleLogin' AND time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP AND accountid in ('123456789012') AND region = 'us-east-1' AND actor.user.name  = 'admin' ORDER BY time_dt DESC
SELECT actor.user.name AS user_name, actor.user.uid AS requestor_arn, count(*) AS total_login FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_cloud_trail_mgmt_2_0 WHERE api.operation = 'ConsoleLogin' AND time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP AND accountid in ('123456789012') AND region = 'us-east-1' AND GET_JSON_OBJECT(api.response.data, '$.ConsoleLogin') = 'Success' GROUP BY actor.user.name, actor.user.uid ORDER BY total_login DESC LIMIT 10
SELECT actor.user.name AS user_name, actor.user.uid AS requestor_arn, count(*) AS total_login FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_cloud_trail_mgmt_2_0 WHERE api.operation = 'ConsoleLogin' AND time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP AND accountid in ('522536594833') AND region = 'us-east-1' AND GET_JSON_OBJECT(api.response.data, '$.ConsoleLogin') = 'Failure' GROUP BY actor.user.name, actor.user.uid ORDER BY total_login DESC LIMIT 10
SELECT time_dt, accountid AS account_id, region AS region, actor.user.uid AS requestor_arn, actor.user.name AS user_name, src_endpoint.ip AS source_ip, api.operation AS api_operation, is_mfa, GET_JSON_OBJECT(api.response.data, '$.ConsoleLogin') AS auth_status, http_request.user_agent AS user_agent FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_cloud_trail_mgmt_2_0 WHERE api.operation = 'ConsoleLogin' AND time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP AND accountid in ('123456789012') AND region = 'us-east-1' AND GET_JSON_OBJECT(api.response.data, '$.ConsoleLogin') = 'Success' AND is_mfa = false ORDER BY time_dt DESC
SELECT time_dt, accountid AS account_id, region AS region, actor.user.uid AS requestor_arn, src_endpoint.ip AS source_ip, api.service.name AS service, api.operation AS api_operation, api.request.data AS request_parameters, api.response.data AS response_elements, api.response.error AS error, api.response.message AS response_message, http_request.user_agent AS user_agent FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_cloud_trail_mgmt_2_0 WHERE api.operation in ('DisableMFADevice', 'DeleteVirtualMFADevice') AND time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP AND accountid in ('123456789012') AND region = 'us-east-1' AND api.response.error IS NULL ORDER BY time_dt DESC
SELECT accountid AS account_id, region AS region, actor.user.uid AS requestor_arn, actor.user.name AS user_name, COUNT(*) AS total_login FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_cloud_trail_mgmt_2_0 WHERE api.operation = 'ConsoleLogin' AND time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP AND accountid in ('123456789012') AND region = 'us-east-1' AND GET_JSON_OBJECT(api.response.data, '$.ConsoleLogin') = 'Success' AND is_mfa = false GROUP BY accountid, region, actor.user.uid, actor.user.name ORDER BY total_login DESC
SELECT time_dt, accountid AS account_id, region AS region, actor.user.uid AS requestor_arn, src_endpoint.ip AS source_ip, api.service.name AS service, api.operation AS api_operation, api.request.data AS request_parameters, api.response.data AS response_elements, api.response.error AS error, api.response.message AS response_message, http_request.user_agent AS user_agent FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_cloud_trail_mgmt_2_0 WHERE time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP AND accountid in ('123456789012') AND region = 'us-east-1' AND api.operation in ( 'CreateSecurityGroup', 'DeleteSecurityGroup', 'RevokeSecurityGroupEgress', 'RevokeSecurityGroupIngress', 'RevokeClientVpnIngress', 'AuthorizeClientVpnIngress', 'AuthorizeSecurityGroupEgress', 'AuthorizeSecurityGroupIngress', 'CreateNetworkAcl', 'DeleteNetworkAcl', 'CreateNetworkAclEntry', 'DeleteNetworkAclEntry', 'ReplaceNetworkAssociation', 'ReplaceNetworkAclEntry' ) ORDER BY time_dt DESC
SELECT time_dt, accountid AS account_id, region AS region, actor.user.uid AS requestor_arn, src_endpoint.ip AS source_ip, api.service.name AS service, api.operation AS api_operation, api.request.data AS request_parameters, api.response.data AS response_elements, api.response.error AS error, api.response.message AS response_message, http_request.user_agent AS user_agent FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_cloud_trail_mgmt_2_0 WHERE time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP AND accountid in ('123456789012') AND region = 'us-east-1' AND ( actor.user.uid = 'arn:aws:sts::123456789012:assumed-role/role/session' OR actor.session.issuer = 'arn:aws:sts::123456789012:role/myrole' ) AND api.operation in ( 'CreateSecurityGroup', 'DeleteSecurityGroup', 'RevokeSecurityGroupEgress', 'RevokeSecurityGroupIngress', 'RevokeClientVpnIngress', 'AuthorizeClientVpnIngress', 'AuthorizeSecurityGroupEgress', 'AuthorizeSecurityGroupIngress', 'CreateNetworkAcl', 'DeleteNetworkAcl', 'CreateNetworkAclEntry', 'DeleteNetworkAclEntry', 'ReplaceNetworkAssociation', 'ReplaceNetworkAclEntry' ) ORDER BY time_dt DESC
SELECT time_dt, accountid AS account_id, region AS region, actor.user.uid AS requestor_arn, src_endpoint.ip AS source_ip, api.service.name AS service, api.operation AS api_operation, api.request.data AS request_parameters, api.response.data AS response_elements, api.response.error AS error, api.response.message AS response_message, http_request.user_agent AS user_agent FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_cloud_trail_mgmt_2_0 WHERE time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP AND accountid in ('123456789012') AND region = 'us-east-1' AND class_uid = 3001 AND api.service.name LIKE 'iam.%' ORDER BY time_dt desc
SELECT time_dt, accountid AS account_id, region AS region, actor.user.uid AS requestor_arn, src_endpoint.ip AS source_ip, api.service.name AS service, api.operation AS api_operation, api.request.data AS request_parameters, api.response.data AS response_elements, api.response.error AS error, api.response.message AS response_message, http_request.user_agent AS user_agent FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_cloud_trail_mgmt_2_0 WHERE time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP AND accountid in ('123456789012') AND region = 'us-east-1' AND ( actor.user.uid = 'arn:aws:sts::123456789012:assumed-role/role/session' OR actor.session.issuer = 'arn:aws:sts::123456789012:role/myrole' ) AND class_uid = 3001 AND api.service.name LIKE 'iam.%' ORDER BY time_dt DESC
SELECT GET_JSON_OBJECT(api.request.data, '$.roleArn') AS assumed_role, COUNT(*) AS total FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_cloud_trail_mgmt_2_0 WHERE api.operation = 'AssumeRole' AND time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP AND actor.user.type != 'AWSService' AND api.response.error IS NULL AND accountid in ('123456789012') AND region = 'us-east-1' GROUP BY GET_JSON_OBJECT(api.request.data, '$.roleArn') ORDER BY total DESC LIMIT 10
SELECT GET_JSON_OBJECT(api.request.data, '$.roleArn') AS assumed_role, COUNT(*) AS total FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_cloud_trail_mgmt_2_0 WHERE api.operation = 'AssumeRole' AND actor.user.type != 'AWSService' AND time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP AND api.response.error IS NULL AND accountid in ('123456789012') AND region = 'us-east-1' GROUP BY GET_JSON_OBJECT(api.request.data, '$.roleArn') ORDER BY total LIMIT 10
SELECT time_dt, accountid AS account_id, region AS region, actor.user.uid AS requestor_arn, src_endpoint.ip AS source_ip, api.operation AS api_operation, GET_JSON_OBJECT(api.response.data, '$.roleArn') AS assumed_role, api.request.data AS request_parameters, api.response.data AS response_elements, api.response.error AS error, http_request.user_agent AS user_agent FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_cloud_trail_mgmt_2_0 WHERE api.operation = 'AssumeRole' AND time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP AND GET_JSON_OBJECT(api.request.data, '$.roleArn')  = 'arn:aws:sts::123456789012:role/myrole' AND accountid in ('123456789012') AND region = 'us-east-1' ORDER BY time_dt DESC
SELECT time_dt, accountid AS account_id, region AS region, actor.user.uid AS requestor_arn, src_endpoint.ip AS source_ip, api.service.name AS service, api.operation AS api_operation, api.request.data AS request_parameters, api.response.data AS response_elements, api.response.error AS error, api.response.message AS response_message, http_request.user_agent AS user_agent FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_cloud_trail_mgmt_2_0 WHERE time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP AND accountid in ('123456789012') AND region = 'us-east-1' AND class_uid = 3001 AND api.service.name LIKE 'kms.%' ORDER BY time_dt DESC
SELECT time_dt, accountid AS account_id, region AS region, actor.user.uid AS requestor_arn, src_endpoint.ip AS source_ip, api.service.name AS service, api.operation AS api_operation, api.request.data AS request_parameters, api.response.data AS response_elements, api.response.error AS error, api.response.message AS response_message, http_request.user_agent AS user_agent FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_cloud_trail_mgmt_2_0 WHERE time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP AND accountid in ('123456789012') AND region = 'us-east-1' AND ( actor.user.uid = 'arn:aws:sts::123456789012:assumed-role/role/session' OR actor.session.issuer = 'arn:aws:sts::123456789012:role/myrole' ) AND class_uid = 3001 AND api.service.name LIKE 'kms.%' ORDER BY time_dt DESC
SELECT resources[0].uid AS key_id, count(*) AS total FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_cloud_trail_mgmt_2_0 WHERE time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP AND accountid in ('123456789012') AND region = 'us-east-1' AND api.service.name LIKE 'kms%' AND api.operation in ('Decrypt', 'Encrypt', 'GenerateDataKey', 'GenerateDataKeyWithoutPlaintext') GROUP BY resources[0].uid
SELECT time_dt, actor.user.uid AS requestor_arn, accountid AS account_id, region AS region, src_endpoint.ip AS source_ip, api.service.name AS service, resources[0].uid AS key_id, api.operation AS api_operation, api.request.data AS request_parameters, api.response.error AS error, api.response.message AS response_message, http_request.user_agent AS user_agent FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_cloud_trail_mgmt_2_0 WHERE time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP AND accountid in ('123456789012') AND region = 'us-east-1' AND resources[0].uid = 'dshgbds-dsfgdsfg' AND api.service.name LIKE 'kms%' AND api.operation in ('Decrypt', 'Encrypt', 'GenerateDataKey', 'GenerateDataKeyWithoutPlaintext') ORDER BY time_dt DESC
SELECT actor.user.uid AS requestor_arn, count(*) AS total FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_cloud_trail_mgmt_2_0 WHERE time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP AND accountid in ('123456789012') AND region = 'us-east-1' AND api.service.name LIKE 'kms%' AND api.operation in ('Decrypt', 'Encrypt', 'GenerateDataKey', 'GenerateDataKeyWithoutPlaintext') GROUP BY actor.user.uid ORDER BY total DESC LIMIT 10
SELECT time_dt, actor.user.uid AS requestor_arn, accountid AS account_id, region AS region, src_endpoint.ip AS source_ip, api.service.name AS service, api.operation AS api_operation, resources[0].uid AS key_id, api.request.data AS request_parameters, api.response.error AS error, api.response.message AS response_message, http_request.user_agent AS user_agent FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_cloud_trail_mgmt_2_0 WHERE time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP AND accountid in ('123456789012') AND region = 'us-east-1' AND resources[0].uid = 'dshgbds-dsfgdsfg' AND ( actor.user.uid = 'arn:aws:sts::123456789012:assumed-role/role/session' OR actor.session.issuer = 'arn:aws:sts::123456789012:role/myrole' ) AND api.service.name LIKE 'kms%' AND api.operation in ('Decrypt', 'Encrypt', 'GenerateDataKey', 'GenerateDataKeyWithoutPlaintext') ORDER BY time_dt DESC
SELECT time_dt, accountid AS account_id, region AS region, actor.user.uid AS requestor_arn, count(*) AS total FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_cloud_trail_mgmt_2_0 WHERE time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP AND accountid in ('123456789012') AND region = 'us-east-1' AND class_uid = 3001 GROUP BY time_dt, actor.user.uid, accountid, region ORDER BY time_dt desc LIMIT 10
SELECT time_dt, accountid AS account_id, region AS region, actor.user.uid AS requestor_arn, src_endpoint.ip AS source_ip, api.service.name AS service, api.operation AS api_operation, api.request.data AS request_parameters, api.response.data AS response_elements, api.response.error AS error, api.response.message AS response_message, http_request.user_agent AS user_agent FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_cloud_trail_mgmt_2_0 WHERE time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP AND accountid in ('123456789012') AND region = 'us-east-1' AND ( actor.user.uid = 'arn:aws:sts::123456789012:assumed-role/role/session' OR actor.session.issuer = 'arn:aws:sts::123456789012:role/myrole' ) AND class_uid = 3001 ORDER BY time_dt DESC
SELECT time_dt, actor.user.uid AS requestor_arn, accountid AS account_id, region AS region, src_endpoint.ip AS source_ip, api.service.name AS service, api.operation AS api_operation, api.request.data AS request_parameters, api.response.data AS response_elements, api.response.error AS error, api.response.message AS response_message, http_request.user_agent AS user_agent FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_cloud_trail_mgmt_2_0 WHERE time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP AND accountid in ('123456789012') AND region = 'us-east-1' AND ( actor.user.uid = 'arn:aws:sts::123456789012:assumed-role/role/session' OR actor.session.issuer = 'arn:aws:sts::123456789012:role/myrole' ) ORDER BY time_dt DESC
SELECT time_dt, actor.user.uid AS requestor_arn, accountid AS account_id, region AS region, src_endpoint.ip AS source_ip, api.service.name AS service, api.operation AS api_operation, api.request.data AS request_parameters, api.response.data AS response_elements, api.response.error AS error, api.response.message AS response_message, http_request.user_agent AS user_agent FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_cloud_trail_mgmt_2_0 WHERE time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP AND accountid in ('123456789012') AND region = 'us-east-1' AND actor.user.credential_uid = 'ASIAXXXXXXXXXXXXXXXX' ORDER BY time_dt DESC
SELECT time_dt, actor.user.uid AS requestor_arn, accountid AS account_id, region AS region, src_endpoint.ip AS source_ip, api.service.name AS service, api.operation AS api_operation, api.request.data AS request_parameters, api.response.data AS response_elements, api.response.error AS error, api.response.message AS response_message, http_request.user_agent AS user_agent FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_cloud_trail_mgmt_2_0 WHERE time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP AND accountid in ('123456789012') AND region = 'us-east-1' AND ( actor.user.uid = 'arn:aws:sts::123456789012:assumed-role/role/session' OR actor.session.issuer = 'arn:aws:sts::123456789012:role/myrole' ) AND api.operation = 'GetSecurityGroup' ORDER BY time_dt DESC
SELECT time_dt, actor.user.uid AS requestor_arn, accountid AS account_id, region AS region, src_endpoint.ip AS source_ip, api.service.name AS service, api.operation AS api_operation, api.request.data AS request_parameters, GET_JSON_OBJECT(api.request.data, '$.tableName') AS table_name, api.response.error AS error, api.response.message AS response_message, http_request.user_agent AS user_agent FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_cloud_trail_mgmt_2_0 WHERE time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP AND accountid in ('123456789012') AND region = 'us-east-1' AND api.service.name LIKE 'dynamodb%' AND api.operation LIKE 'DeleteTable' ORDER BY time_dt DESC
SELECT time_dt, actor.user.uid AS requestor_arn, accountid AS account_id, region AS region, src_endpoint.ip AS source_ip, api.service.name AS service, api.operation AS api_operation, api.request.data AS request_parameters, api.response.error AS error, api.response.message AS response_message, http_request.user_agent AS user_agent FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_cloud_trail_mgmt_2_0 WHERE time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP AND accountid in ('123456789012') AND region = 'us-east-1' AND api.service.name LIKE 'cloudtrail%' AND api.operation in ('DeleteTrail', 'StopLogging', 'UpdateTrail') ORDER BY time_dt DESC
SELECT time_dt, actor.user.uid AS requestor_arn, accountid AS account_id, region AS region, src_endpoint.ip AS source_ip, api.service.name AS service, api.operation AS api_operation, api.request.data AS request_parameters, api.response.error AS error, api.response.message AS response_message, http_request.user_agent AS user_agent FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_cloud_trail_mgmt_2_0 WHERE time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP AND accountid in ('123456789012') AND region = 'us-east-1' AND api.service.name LIKE 'iam%' AND api.operation in ('CreateAccessKey', 'DeleteAccessKey', 'UpdateAccessKey') ORDER BY time_dt DESC
SELECT time_dt, actor.user.uid AS requestor_arn, accountid AS account_id, region AS region, src_endpoint.ip AS source_ip, api.service.name AS service, api.operation AS api_operation, api.request.data AS request_parameters, api.response.error AS error, api.response.message AS response_message, http_request.user_agent AS user_agent FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_cloud_trail_mgmt_2_0 WHERE time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP AND accountid in ('123456789012') AND region = 'us-east-1' AND api.service.name LIKE 'iam%' AND api.operation in ( 'AttachGroupPolicy', 'AttachRolePolicy', 'AttachUserPolicy', 'CreatePolicy', 'CreatePolicyVersion', 'DeleteAccountPasswordPolicy', 'DeleteGroupPolicy', 'DeletePolicyVersion', 'DeleteUserPolicy', 'DetachGroupPolicy', 'DetachRolePolicy', 'DetachUserPolicy', 'PutGroupPolicy', 'PutRolePolicy', 'PutUserPolicy', 'SetDefaultPolicyVersion', 'UpdateAssumeRolePolicy', 'UpdateAccountPasswordPolicy' ) ORDER BY time_dt DESC
SELECT time_dt, actor.user.uid AS requestor_arn, accountid AS account_id, region AS region, src_endpoint.ip AS source_ip, api.service.name AS service, api.operation AS api_operation, api.request.data AS request_parameters, api.response.error AS error, api.response.message AS response_message, http_request.user_agent AS user_agent FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_cloud_trail_mgmt_2_0 WHERE time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP AND accountid in ('123456789012') AND region = 'us-east-1' AND api.service.name LIKE 'iam%' AND api.operation in ( 'CreateIamRole' 'DeleteIamRole' 'CreateIamUser' 'DeleteIamUser' ) ORDER BY time_dt DESC
SELECT accountid AS account_id, region AS region, src_endpoint.instance_uid AS instance_id, COUNT(DISTINCT query.hostname) AS total FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_route53_2_0 WHERE accountid IN ('123456789012') AND region = 'us-east-1' AND time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP GROUP BY accountid, region, src_endpoint.instance_uid ORDER BY total DESC LIMIT 10
SELECT accountid AS account_id, region AS region, query.hostname AS query_hostname, COUNT(query.hostname) AS total FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_route53_2_0 WHERE accountid IN ('123456789012') AND region = 'us-east-1' AND time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP GROUP BY accountid, region, query.hostname ORDER BY total DESC LIMIT 10
SELECT accountid AS account_id, region AS region, query.hostname AS query_hostname, COUNT(query.hostname) AS total FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_route53_2_0 WHERE accountid IN ('123456789012') AND region = 'us-east-1' AND src_endpoint.instance_uid = 'i-0123456789012' AND time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP GROUP BY accountid, region, query.hostname ORDER BY total DESC LIMIT 10
SELECT accountid AS account_id, region AS region, query.hostname AS query_hostname, COUNT(query.hostname) AS total FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_route53_2_0 WHERE accountid IN ('123456789012') AND region = 'us-east-1' AND time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP GROUP BY accountid, region, query.hostname ORDER BY total LIMIT 10
SELECT accountid AS account_id, region AS region, query.hostname AS query_hostname, COUNT(query.hostname) AS total FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_route53_2_0 WHERE accountid IN ('123456789012') AND region = 'us-east-1' AND src_endpoint.instance_uid = 'i-0123456789012' AND time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP GROUP BY accountid, region, query.hostname ORDER BY total LIMIT 10
SELECT accountid AS account_id, region AS region, query.hostname AS query_hostname, COUNT(*) AS total FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_route53_2_0 WHERE accountid IN ('123456789012') AND region = 'us-east-1' AND time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP AND rcode = 'NXDomain' GROUP BY accountid, region, query.hostname ORDER BY total DESC LIMIT 10
SELECT accountid AS account_id, region AS region, query.hostname AS query_hostname, COUNT(*) AS total FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_route53_2_0 WHERE accountid IN ('123456789012') AND region = 'us-east-1' AND src_endpoint.instance_uid = 'i-0123456789012' AND time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP AND rcode = 'NXDomain' GROUP BY accountid, region, query.hostname ORDER BY total DESC LIMIT 10
SELECT accountid AS account_id, region AS region, split_part(query.hostname, '.', -2) AS tld, COUNT(*) AS total FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_route53_2_0 WHERE accountid IN ('123456789012') AND region = 'us-east-1' AND time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP GROUP BY accountid, region, split_part(query.hostname, '.', -2) ORDER BY total LIMIT 10
SELECT accountid AS account_id, region AS region, split_part(query.hostname, '.', -2) AS tld, COUNT(*) AS total FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_route53_2_0 WHERE accountid IN ('123456789012') AND region = 'us-east-1' AND src_endpoint.instance_uid = 'i-0123456789012' AND time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP GROUP BY accountid, region, split_part(query.hostname, '.', -2) ORDER BY total LIMIT 10
SELECT accountid AS account_id, region AS region, query.hostname AS query_hostname, LENGTH(query.hostname) AS domain_length FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_route53_2_0 WHERE accountid IN ('123456789012') AND region = 'us-east-1' AND time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP GROUP BY accountid, region, query.hostname, LENGTH(query.hostname) ORDER BY LENGTH(query.hostname) DESC LIMIT 10
SELECT accountid AS account_id, region AS region, query.hostname AS query_hostname, LENGTH(query.hostname) AS domain_length FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_route53_2_0 WHERE accountid IN ('123456789012') AND region = 'us-east-1' AND src_endpoint.instance_uid = 'i-0123456789012' AND time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP GROUP BY accountid, region, query.hostname, LENGTH(query.hostname) ORDER BY LENGTH(query.hostname) DESC LIMIT 10
SELECT time_dt, accountid AS account_id, region AS region, src_endpoint.instance_uid AS instance_id, query.hostname AS query_hostname, answers, rcode FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_route53_2_0 WHERE accountid IN ('123456789012') AND region = 'us-east-1' AND time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP AND src_endpoint.instance_uid = 'i-0123456789012' ORDER BY time_dt DESC
SELECT time_dt, accountid AS account_id, region AS region, src_endpoint.instance_uid AS instance_id, query.hostname AS query_hostname, answers, rcode FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_route53_2_0 WHERE accountid IN ('123456789012') AND region = 'us-east-1' AND query.hostname = 'myhost' AND time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP ORDER BY time_dt DESC
SELECT time_dt, accountid AS account_id, region AS region, src_endpoint.instance_uid AS instance_id, query.hostname AS query_hostname, answers, rcode FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_route53_2_0 WHERE accountid IN ('123456789012') AND region = 'us-east-1' AND query.hostname LIKE '%.com.' AND time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP ORDER BY time_dt DESC
SELECT time_dt, accountid AS account_id, region AS region, src_endpoint.instance_uid AS instance_id, query.hostname AS query_hostname, answers, rcode FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_route53_2_0 WHERE accountid IN ('123456789012') AND region = 'us-east-1' AND query.hostname = 'myhost' AND src_endpoint.instance_uid = 'i-0123456789012' AND time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP ORDER BY time_dt DESC
SELECT time_dt, accountid AS account_id, region AS region, src_endpoint.instance_uid AS instance_id, query.hostname AS query_hostname, answer, rcode FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_route53_2_0 a LATERAL VIEW EXPLODE(a.answers) AS answer WHERE accountid IN ('123456789012') AND region = 'us-east-1' AND answer.rdata = '192.168.1.0' AND time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP ORDER BY time_dt DESC
SELECT time_dt, accountid AS account_id, region AS region, src_endpoint.instance_uid AS instance_id, query.hostname AS query_hostname, answer, rcode FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_route53_2_0 a LATERAL VIEW EXPLODE(a.answers) AS answer WHERE accountid IN ('123456789012') AND region = 'us-east-1' AND answer.rdata = '192.168.1.0' AND src_endpoint.instance_uid = 'i-0123456789012' AND time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP ORDER BY time_dt DESC
SELECT DISTINCT query.hostname AS query_hostname FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_route53_2_0 a LATERAL VIEW EXPLODE(a.answers) AS answer WHERE accountid IN ('123456789012') AND region = 'us-east-1' AND answer.rdata = '192.168.1.0' AND time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP
SELECT DISTINCT query.hostname AS query_hostname FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_route53_2_0 a LATERAL VIEW EXPLODE(a.answers) AS answer WHERE accountid IN ('123456789012') AND region = 'us-east-1' AND answer.rdata = '192.168.1.0' AND src_endpoint.instance_uid = 'i-0123456789012' AND time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP
WITH a AS (SELECT finding_info.created_time_dt AS created_time, finding_info.modified_time_dt AS modified_time, accountid AS account_id, region, class_name, finding_info.uid AS finding_id, severity, finding_info.types AS finding_types, finding_info.title AS title, finding_info.desc AS description, CASE WHEN class_uid = 2002 THEN TO_JSON(vulnerabilities) WHEN class_uid = 2003 THEN TO_JSON(compliance) WHEN class_uid = 2004 THEN TO_JSON(evidences) END AS evidences, remediation, CASE WHEN class_uid = 2004 THEN TO_JSON(r) ELSE TO_JSON(resource) END AS resource FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_sh_findings_2_0 a LATERAL VIEW EXPLODE(a.resources) AS r WHERE accountid in ('123456789012') AND region = 'us-east-1' AND time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP ) SELECT * FROM a WHERE GET_JSON_OBJECT(resource, '$.type') = 'AwsEc2Instance'
SELECT finding_info.created_time_dt AS created_time, finding_info.modified_time_dt AS modified_time, accountid AS account_id, region, class_name, finding_info.uid AS finding_id, severity, finding_info.types AS finding_types, finding_info.title AS title, finding_info.desc AS description, CASE WHEN class_uid = 2002 THEN TO_JSON(vulnerabilities) WHEN class_uid = 2003 THEN TO_JSON(compliance) WHEN class_uid = 2004 THEN TO_JSON(evidences) END AS evidences, remediation, CASE WHEN class_uid = 2004 THEN TO_JSON(resources) ELSE TO_JSON(resource) END AS resource FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_sh_findings_2_0 a LATERAL VIEW EXPLODE(a.observables) AS observable WHERE accountid in ('123456789012') AND region = 'us-east-1' AND time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP AND observable.value = 'hostnames'
SELECT finding_info.created_time_dt AS created_time, finding_info.modified_time_dt AS modified_time, accountid AS account_id, region, class_name, finding_info.uid AS finding_id, severity, finding_info.types AS finding_types, finding_info.title AS title, finding_info.desc AS description, CASE WHEN class_uid = 2002 THEN TO_JSON(vulnerabilities) WHEN class_uid = 2003 THEN TO_JSON(compliance) WHEN class_uid = 2004 THEN TO_JSON(evidences) END AS evidences, remediation, CASE WHEN class_uid = 2004 THEN TO_JSON(r) ELSE TO_JSON(resource) END AS resource FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_sh_findings_2_0 a LATERAL VIEW EXPLODE(a.resources) AS r WHERE accountid in ('123456789012') AND region = 'us-east-1' AND time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP AND severity = 'Critical'
SELECT finding_info.created_time_dt AS created_time, finding_info.modified_time_dt AS modified_time, accountid AS account_id, region, class_name, finding_info.uid AS finding_id, severity, finding_info.types AS finding_types, finding_info.title AS title, finding_info.desc AS description, CASE WHEN class_uid = 2002 THEN TO_JSON(vulnerabilities) WHEN class_uid = 2003 THEN TO_JSON(compliance) WHEN class_uid = 2004 THEN TO_JSON(evidences) END AS evidences, remediation, CASE WHEN class_uid = 2004 THEN TO_JSON(r) ELSE TO_JSON(resource) END AS resource FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_sh_findings_2_0 a LATERAL VIEW EXPLODE(a.resources) AS r WHERE accountid in ('123456789012') AND region = 'us-east-1' AND time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP AND finding_info.uid = 'abc'
SELECT accountid AS account_id, cloud.region AS region, class_uid, class_name, severity, count(*) AS total FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_sh_findings_2_0 WHERE accountid in ('123456789012') AND region = 'us-east-1' AND time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP GROUP BY accountid, cloud.region, class_uid, class_name, severity ORDER BY total DESC
SELECT accountid AS account_id, region, finding_info.types AS finding_types, finding_info.desc AS description, severity, count(*) AS total FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_sh_findings_2_0 WHERE accountid in ('123456789012') AND region = 'us-east-1' AND time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP AND class_name = 'Detection Finding' GROUP BY accountid, region, finding_info.types, finding_info.desc, severity ORDER BY total DESC
SELECT finding_info.created_time_dt AS created_time, finding_info.modified_time_dt AS modified_time, accountid AS account_id, region, class_name, finding_info.uid AS finding_id, severity, finding_info.types AS finding_types, finding_info.title AS title, finding_info.desc AS description, remediation, evidence FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_sh_findings_2_0 a LATERAL VIEW EXPLODE(a.evidences) AS evidence WHERE accountid in ('123456789012') AND region = 'us-east-1' AND time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP AND class_name = 'Detection Finding' AND evidence.api.operation = 'GetSecurityGroup'
SELECT finding_info.created_time_dt AS created_time, finding_info.modified_time_dt AS modified_time, accountid AS account_id, region, class_name, finding_info.uid AS finding_id, severity, finding_info.types AS finding_types, remediation, evidence FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_sh_findings_2_0 a LATERAL VIEW EXPLODE(a.evidences) AS evidence WHERE accountid in ('123456789012') AND region = 'us-east-1' AND time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP AND class_name = 'Detection Finding' AND evidence.api.service.name LIKE 'iam%'
SELECT finding_info.created_time_dt AS created_time, finding_info.modified_time_dt AS modified_time, accountid AS account_id, region, class_name, finding_info.uid AS finding_id, severity, finding_info.types AS finding_types, remediation, evidence FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_sh_findings_2_0 a LATERAL VIEW EXPLODE(a.evidences) AS evidence WHERE accountid in ('123456789012') AND region = 'us-east-1' AND time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP AND class_name = 'Detection Finding' AND evidence.src_endpoint.location.country = 'usa'
SELECT finding_info.created_time_dt AS created_time, finding_info.modified_time_dt AS modified_time, accountid AS account_id, region, class_name, finding_info.uid AS finding_id, severity, finding_info.types AS finding_types, remediation, vulnerability FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_sh_findings_2_0 a LATERAL VIEW EXPLODE(a.vulnerabilities) AS vulnerability WHERE accountid in ('123456789012') AND region = 'us-east-1' AND time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP AND class_name = 'Vulnerability Finding' AND vulnerability.cve.uid  = 'CVE-123'
WITH a AS ( SELECT finding_info.created_time_dt AS created_time, finding_info.modified_time_dt AS modified_time, accountid AS account_id, region, class_name, finding_info.uid AS finding_id, severity, finding_info.types AS finding_types, remediation, vulnerability, vulnerability.affected_packages AS affected_packages FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_sh_findings_2_0 a LATERAL VIEW EXPLODE(a.vulnerabilities) AS vulnerability WHERE accountid in ('123456789012') AND region = 'us-east-1' AND time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP AND class_name = 'Vulnerability Finding' ) SELECT created_time, modified_time, account_id, region, class_name, finding_id, severity, finding_types, remediation, vulnerability FROM a b LATERAL VIEW EXPLODE(b.affected_packages) AS affected_package WHERE affected_package.name = 'mypkg'
SELECT accountid AS account_id, region AS region, src_endpoint.ip AS source_ip, dst_endpoint.instance_uid AS instance_id, dst_endpoint.interface_uid AS eni_id, COUNT(*) AS total_blocked_inbound_connection FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_vpc_flow_2_0 WHERE accountid IN ('123456789012') AND region = 'us-east-1' AND time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP AND status_code = 'OK' AND action = 'Denied' GROUP BY accountid, region, src_endpoint.ip, dst_endpoint.instance_uid, dst_endpoint.interface_uid ORDER BY total_blocked_inbound_connection DESC LIMIT 10
SELECT start_time_dt AS start_time, end_time_dt AS end_time, accountid AS account_id, region AS region, src_endpoint.ip AS source_ip, dst_endpoint.instance_uid AS instance_id, dst_endpoint.vpc_uid AS destination_vpc_uid, dst_endpoint.port AS destination_port, dst_endpoint.interface_uid AS eni_id FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_vpc_flow_2_0 WHERE accountid IN ('123456789012') AND region = 'us-east-1' AND time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP AND action = 'Denied' AND src_endpoint.ip = '192.168.1.0' AND status_code = 'OK' ORDER BY start_time_dt DESC
SELECT start_time_dt AS start_time, end_time_dt AS end_time, accountid AS account_id, region AS region, src_endpoint.ip AS source_ip, dst_endpoint.instance_uid AS instance_id, dst_endpoint.vpc_uid AS destination_vpc_uid, dst_endpoint.port AS destination_port, dst_endpoint.interface_uid AS eni_id FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_vpc_flow_2_0 WHERE accountid IN ('123456789012') AND region = 'us-east-1' AND time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP AND action = 'Denied' AND dst_endpoint.instance_uid = 'i-0123456789012' AND status_code = 'OK' ORDER BY start_time_dt DESC
SELECT src_endpoint.ip AS source_ip, COUNT(*) AS total FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_vpc_flow_2_0 WHERE accountid IN ('123456789012') AND region = 'us-east-1' AND dst_endpoint.instance_uid = 'i-0123456789012' AND time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP AND connection_info.direction = 'Inbound' AND status_code = 'OK' GROUP BY src_endpoint.ip ORDER BY total DESC LIMIT 10
SELECT dst_endpoint.ip AS destination_ip, COUNT(*) AS total FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_vpc_flow_2_0 WHERE accountid IN ('123456789012') AND region = 'us-east-1' AND src_endpoint.instance_uid = 'i-0123456789012' AND time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP AND connection_info.direction = 'Outbound' AND status_code = 'OK' GROUP BY dst_endpoint.ip ORDER BY total DESC LIMIT 10
SELECT dst_endpoint.port AS destination_port, COUNT(*) AS total FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_vpc_flow_2_0 WHERE accountid IN ('123456789012') AND region = 'us-east-1' AND dst_endpoint.instance_uid = 'i-0123456789012' AND time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP AND connection_info.direction = 'Inbound' AND status_code = 'OK' GROUP BY dst_endpoint.port ORDER BY total DESC LIMIT 10
SELECT dst_endpoint.ip AS destination_ip, dst_endpoint.port AS destination_port, COUNT(*) AS total FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_vpc_flow_2_0 WHERE accountid IN ('123456789012') AND region = 'us-east-1' AND src_endpoint.instance_uid = 'i-0123456789012' AND time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP AND connection_info.direction = 'Outbound' AND status_code = 'OK' GROUP BY dst_endpoint.ip, dst_endpoint.port ORDER BY total DESC LIMIT 10
SELECT dst_endpoint.ip AS destination_ip, dst_endpoint.port AS destination_port, COUNT(*) AS total FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_vpc_flow_2_0 WHERE accountid IN ('123456789012') AND region = 'us-east-1' AND src_endpoint.instance_uid = 'i-0123456789012' AND time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP AND connection_info.direction = 'Outbound' AND status_code = 'OK' GROUP BY dst_endpoint.ip, dst_endpoint.port ORDER BY total LIMIT 10
SELECT accountid AS account_id, region AS region, src_endpoint.ip AS source_ip, dst_endpoint.instance_uid AS instance_id, dst_endpoint.interface_uid AS eni_id, SUM(traffic.bytes) / 1000 AS total_inbound_kilobytes FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_vpc_flow_2_0 WHERE accountid IN ('123456789012') AND region = 'us-east-1' AND time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP AND connection_info.direction = 'Inbound' AND status_code = 'OK' GROUP BY accountid, region, src_endpoint.ip, dst_endpoint.instance_uid, dst_endpoint.interface_uid ORDER BY total_inbound_kilobytes DESC LIMIT 10
SELECT accountid AS account_id, region AS region, src_endpoint.instance_uid AS instance_id, src_endpoint.interface_uid AS eni_id, dst_endpoint.ip AS destination_ip, SUM(traffic.bytes) / 1000 AS total_outbound_kilobytes FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_vpc_flow_2_0 WHERE accountid IN ('123456789012') AND region = 'us-east-1' AND time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP AND connection_info.direction = 'Outbound' AND status_code = 'OK' GROUP BY accountid, region, src_endpoint.instance_uid, src_endpoint.interface_uid, dst_endpoint.ip ORDER BY total_outbound_kilobytes DESC LIMIT 10
SELECT accountid AS account_id, region AS region, src_endpoint.instance_uid AS instance_id, src_endpoint.interface_uid AS eni_id, dst_endpoint.ip AS destination_ip, SUM(traffic.bytes) / 1000 AS total_outbound_kilobytes FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_vpc_flow_2_0 WHERE accountid IN ('123456789012') AND region = 'us-east-1' AND time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP AND connection_info.direction = 'Outbound' AND status_code = 'OK' AND src_endpoint.instance_uid = 'i-0123456789012' GROUP BY accountid, region, src_endpoint.instance_uid, src_endpoint.interface_uid, dst_endpoint.ip ORDER BY total_outbound_kilobytes DESC LIMIT 10
SELECT accountid AS account_id, region AS region, src_endpoint.ip AS source_ip, dst_endpoint.instance_uid AS instance_id, SUM(traffic.bytes) / 1000 AS total_inbound_kilobytes FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_vpc_flow_2_0 WHERE accountid IN ('123456789012') AND region = 'us-east-1' AND time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP AND connection_info.direction = 'Inbound' AND status_code = 'OK' AND dst_endpoint.instance_uid = 'i-0123456789012' GROUP BY accountid, region, src_endpoint.ip, dst_endpoint.instance_uid ORDER BY total_inbound_kilobytes DESC LIMIT 10
SELECT accountid AS account_id, region AS region, src_endpoint.ip AS source_ip, COUNT (DISTINCT dst_endpoint.instance_uid) AS unique_instance_amount FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_vpc_flow_2_0 WHERE accountid IN ('123456789012') AND region = 'us-east-1' AND time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP AND connection_info.direction = 'Inbound' AND status_code = 'OK' GROUP BY accountid, region, src_endpoint.ip ORDER BY unique_instance_amount DESC LIMIT 10
SELECT accountid AS account_id, region AS region, src_endpoint.ip AS source_ip, COUNT(DISTINCT dst_endpoint.port) AS unique_port_amount FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_vpc_flow_2_0 WHERE accountid IN ('123456789012') AND region = 'us-east-1' AND time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP AND connection_info.direction = 'Inbound' AND dst_endpoint.instance_uid = 'i-0123456789012' AND status_code = 'OK' GROUP BY accountid, region, src_endpoint.ip ORDER BY unique_port_amount DESC LIMIT 10
SELECT accountid AS account_id, region AS region, src_endpoint.ip AS source_ip, dst_endpoint.instance_uid AS instance_id, dst_endpoint.interface_uid AS eni_id, COUNT(DISTINCT dst_endpoint.port) AS unique_port_amount FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_vpc_flow_2_0 WHERE accountid IN ('123456789012') AND region = 'us-east-1' AND time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP AND connection_info.direction = 'Inbound' AND status_code = 'OK' GROUP BY accountid, region, src_endpoint.ip, dst_endpoint.instance_uid, dst_endpoint.interface_uid ORDER BY unique_port_amount DESC LIMIT 10
SELECT accountid AS account_id, region AS region, src_endpoint.ip AS source_ip, dst_endpoint.port AS destination_port, COUNT(*) AS total_rejected FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_vpc_flow_2_0 WHERE accountid IN ('123456789012') AND region = 'us-east-1' AND time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP AND connection_info.direction = 'Inbound' AND status_code = 'OK' AND dst_endpoint.instance_uid = 'i-0123456789012' AND action = 'Denied' GROUP BY accountid, region, src_endpoint.ip, dst_endpoint.port ORDER BY total_rejected DESC LIMIT 10
SELECT src_endpoint.ip AS source_ip, dst_endpoint.port AS destination_port, dst_endpoint.interface_uid AS eni_id, SUM(traffic.bytes)/1000 AS total_inbound_kilobytes, SUM(traffic.packets) AS total_inbound_packets, COUNT(CASE WHEN action = 'Denied' THEN 1 ELSE 0 END) AS total_blocked, COUNT(CASE WHEN action = 'Allowed' THEN 1 ELSE 0 END) AS total_allowed, COUNT(*) AS total_connections FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_vpc_flow_2_0 WHERE accountid IN ('123456789012') AND region = 'us-east-1' AND time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP AND connection_info.direction = 'Inbound' AND status_code = 'OK' AND dst_endpoint.instance_uid = 'i-0123456789012' GROUP BY src_endpoint.ip, dst_endpoint.port, dst_endpoint.interface_uid ORDER BY total_connections DESC LIMIT 10
SELECT src_endpoint.interface_uid AS eni_id, dst_endpoint.ip AS source_ip, dst_endpoint.port AS destination_port, SUM(traffic.bytes)/1000 AS total_outbound_kilobytes, SUM(traffic.packets) AS total_outbound_packets, COUNT(CASE WHEN action = 'Denied' THEN 1 ELSE 0 END) AS total_blocked, COUNT(CASE WHEN action = 'Allowed' THEN 1 ELSE 0 END) AS total_allowed, COUNT(*) AS total_connections FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_vpc_flow_2_0 WHERE accountid IN ('123456789012') AND region = 'us-east-1' AND time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP AND connection_info.direction = 'Outbound' AND status_code = 'OK' AND src_endpoint.instance_uid = 'i-0123456789012' GROUP BY src_endpoint.interface_uid, dst_endpoint.ip, dst_endpoint.port ORDER BY total_connections DESC LIMIT 10
SELECT src_endpoint.instance_uid AS src_instance_id, src_endpoint.interface_uid AS src_eni_id, src_endpoint.ip AS src_ip, src_endpoint.port AS src_port, connection_info.direction AS direction, dst_endpoint.instance_uid AS dst_instance_id, dst_endpoint.interface_uid AS dst_eni_id, dst_endpoint.ip AS dst_ip, dst_endpoint.port AS dst_port, SUM(traffic.bytes)/1000 AS total_volume_kb, SUM(traffic.packets) AS total_inbound_packets, COUNT(CASE WHEN action = 'Denied' THEN 1 ELSE 0 END) AS total_blocked, COUNT(CASE WHEN action = 'Allowed' THEN 1 ELSE 0 END) AS total_allowed, COUNT(*) AS total_connections FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_vpc_flow_2_0 WHERE accountid IN ('123456789012') AND region = 'us-east-1' AND time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP AND status_code = 'OK' AND ( dst_endpoint.instance_uid = 'i-0123456789012' OR src_endpoint.instance_uid = 'i-0123456789012' ) GROUP BY src_endpoint.instance_uid, src_endpoint.interface_uid, src_endpoint.ip, src_endpoint.port,connection_info.direction, dst_endpoint.instance_uid, dst_endpoint.interface_uid, dst_endpoint.ip, dst_endpoint.port ORDER BY total_connections DESC
SELECT start_time_dt AS start_time, end_time_dt AS end_time, accountid AS account_id, region AS region, src_endpoint.ip AS source_ip, dst_endpoint.instance_uid AS instance_id, dst_endpoint.vpc_uid AS destination_vpc_uid, dst_endpoint.port AS destination_port, dst_endpoint.interface_uid AS eni_id FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_vpc_flow_2_0 WHERE accountid IN ('123456789012') AND region = 'us-east-1' AND time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP AND connection_info.direction = 'Inbound' AND status_code = 'OK' AND dst_endpoint.instance_uid = 'i-0123456789012' AND dst_endpoint.port = 22 ORDER BY start_time_dt DESC
SELECT start_time_dt AS start_time, end_time_dt AS end_time, accountid AS account_id, region AS region, src_endpoint.ip AS source_ip, dst_endpoint.instance_uid AS instance_id, dst_endpoint.vpc_uid AS destination_vpc_uid, dst_endpoint.port AS destination_port, dst_endpoint.interface_uid AS eni_id FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_vpc_flow_2_0 WHERE accountid IN ('123456789012') AND region = 'us-east-1' AND time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP AND connection_info.direction = 'Inbound' AND status_code = 'OK' AND dst_endpoint.instance_uid = 'i-0123456789012' AND dst_endpoint.port = 3389 ORDER BY start_time_dt DESC
SELECT start_time_dt AS start_time, end_time_dt AS end_time, accountid AS account_id, region AS region, src_endpoint.ip AS source_ip, src_endpoint.instance_uid AS instance_id, src_endpoint.interface_uid AS eni_id, dst_endpoint.ip AS destination_ip, dst_endpoint.port AS destination_port FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_vpc_flow_2_0 WHERE accountid IN ('123456789012') AND region = 'us-east-1' AND time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP AND src_endpoint.instance_uid = 'i-0123456789012' AND connection_info.direction = 'Outbound' AND connection_info.protocol_num = 6 AND status_code = 'OK' AND dst_endpoint.port = 443 ORDER BY start_time_dt DESC
SELECT start_time_dt AS start_time, end_time_dt AS end_time, accountid AS account_id, region AS region, src_endpoint.ip AS source_ip, src_endpoint.instance_uid AS instance_id, src_endpoint.interface_uid AS eni_id, dst_endpoint.ip AS destination_ip, dst_endpoint.port AS destination_port FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_vpc_flow_2_0 WHERE accountid IN ('123456789012') AND region = 'us-east-1' AND time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP AND connection_info.direction = 'Outbound' AND connection_info.protocol_num = 17 AND status_code = 'OK' AND dst_endpoint.port = 53 AND src_endpoint.instance_uid = 'i-0123456789012' ORDER BY start_time_dt DESC
SELECT start_time_dt AS start_time, end_time_dt AS end_time, accountid AS account_id, region AS region, src_endpoint.ip AS source_ip, src_endpoint.instance_uid AS instance_id, src_endpoint.interface_uid AS eni_id, dst_endpoint.ip AS destination_ip, dst_endpoint.port AS destination_port FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_vpc_flow_2_0 WHERE accountid IN ('123456789012') AND region = 'us-east-1' AND time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP AND connection_info.direction = 'Outbound' AND connection_info.protocol_num = 1 AND status_code = 'OK' AND src_endpoint.instance_uid = 'i-0123456789012' ORDER BY start_time_dt DESC
SELECT start_time_dt AS start_time, end_time_dt AS end_time, accountid AS account_id, region AS region, src_endpoint.ip AS source_ip, src_endpoint.instance_uid AS instance_id, src_endpoint.interface_uid AS eni_id, dst_endpoint.ip AS destination_ip, dst_endpoint.port AS destination_port FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_vpc_flow_2_0 WHERE accountid IN ('123456789012') AND region = 'us-east-1' AND time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP AND connection_info.direction = 'Inbound' AND connection_info.protocol_num = 1 AND status_code = 'OK' AND dst_endpoint.instance_uid = 'i-0123456789012' ORDER BY start_time_dt DESC
SELECT start_time_dt AS start_time, end_time_dt AS end_time, accountid AS account_id, region, src_endpoint.ip AS source_ip, connection_info.protocol_ver AS ip_version, src_endpoint.port AS source_port, src_endpoint.instance_uid AS source_instance_id, src_endpoint.vpc_uid AS source_vpc_uid, src_endpoint.svc_name AS source_service, connection_info.direction AS direction, dst_endpoint.ip AS dest_ip, dst_endpoint.port AS dest_port, dst_endpoint.instance_uid AS dest_instance_id, dst_endpoint.vpc_uid AS dest_vpc_uid, dst_endpoint.svc_name AS dest_service, connection_info.boundary AS boundary, traffic.bytes AS traffic_bytes, action FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_vpc_flow_2_0 WHERE accountid IN ('123456789012') AND region = 'us-east-1' AND time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP AND status_code = 'OK' AND ( dst_endpoint.ip = '192.168.1.0' OR src_endpoint.ip = '192.168.1.0' )
SELECT start_time_dt AS start_time, end_time_dt AS end_time, accountid AS account_id, region, src_endpoint.ip AS source_ip, connection_info.protocol_ver AS ip_version, src_endpoint.port AS source_port, src_endpoint.instance_uid AS source_instance_id, src_endpoint.vpc_uid AS source_vpc_uid, src_endpoint.svc_name AS source_service, connection_info.direction AS direction, dst_endpoint.ip AS dest_ip, dst_endpoint.port AS dest_port, dst_endpoint.instance_uid AS dest_instance_id, dst_endpoint.vpc_uid AS dest_vpc_uid, dst_endpoint.svc_name AS dest_service, connection_info.boundary AS boundary, traffic.bytes AS traffic_bytes, action FROM amazon_security_lake_glue_db_us_east_1.amazon_security_lake_table_us_east_1_vpc_flow_2_0 WHERE accountid IN ('123456789012') AND region = 'us-east-1' AND time_dt BETWEEN CURRENT_TIMESTAMP - INTERVAL '7' DAY AND CURRENT_TIMESTAMP AND status_code = 'OK' AND ( ( dst_endpoint.instance_uid = 'i-0123456789012' AND src_endpoint.ip = '192.168.1.0' ) OR ( src_endpoint.instance_uid = 'i-0123456789012' AND dst_endpoint.ip = '192.168.1.0' ) )